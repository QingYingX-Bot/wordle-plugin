# 更新日志

所有重要的项目变更都会记录在此文件中。

## [fork-1.0.12] - 2025-12-05

### 🔧 优化改进

#### 单词游戏默认行为优化
- 修改 `#word` 命令的默认行为：从固定5字母改为随机选择3-10之间的字母数
- 智能随机选择：如果随机选择的字母数在当前词典中没有单词，会自动尝试其他字母数
- 提升游戏趣味性和挑战性

---

## [fork-1.0.11] - 2025-12-05

### ✨ 新增功能

#### 功能控制开关
- 添加 `#开启wordle游戏` 和 `#关闭wordle游戏` 命令
- 支持群组级别的功能开关控制
- 默认所有群组都未启用，需要管理员手动开启
- 仅群管理、群主、机器人主人可以使用开关命令

#### 统一帮助命令
- 添加 `#wordle 帮助` 命令，显示所有游戏的帮助信息
- 使用合并转发消息，将帮助信息分为4个部分：
  - 功能控制说明
  - 单词游戏帮助
  - 数学公式游戏帮助
  - 成语游戏帮助

### 🔧 优化改进

#### 权限检查优化
- 优化权限检查逻辑，只在有进行中的游戏时才检查权限
- 避免普通消息触发权限检查提示
- 改进 `listenMessages` 方法，先检查游戏状态再检查权限

#### 数据存储优化
- 修复排行榜数据文件存储路径问题
- 数据文件现在正确存储在 `data/` 目录下，而不是 `utils/data/` 目录
- 自动迁移现有数据文件到正确位置

### 🐛 修复问题

- 修复权限检查过于宽泛导致普通消息也触发提示的问题
- 修复排行榜数据文件存储路径错误的问题
- 修复数据文件位置不正确的问题

---

## [fork-1.0.1] - 2025-12-04

### ✨ 新增功能

#### 成语游戏（汉兜）功能
- 支持使用 `#idiom`、`#成语`、`#汉兜` 命令启动成语猜谜游戏
- 固定四字成语，10次猜测机会
- 完整的成语数据管理，包含成语、拼音、解释信息
- 成语游戏排行榜功能
- 拼音显示和拼音级别反馈功能
  - 每个格子显示拼音（上方）和汉字（下方）
  - 声母、韵母、声调独立判断和颜色反馈
  - 颜色含义：青色=正确，橙色=存在但位置错误，灰色=不存在

### 🔧 优化改进

#### 渲染优化
- 优化成语游戏格子大小（80x80像素）以适应拼音和汉字显示
- 优化拼音和汉字的布局和字体大小
- 使用 Noto Serif SC 字体渲染中文，提升显示效果

#### 用户体验优化
- 游戏开始消息中添加详细的规则说明
- 优化拼音级别的反馈逻辑，支持跨位置检查
- 改进显示效果，拼音和汉字间距更合理

### 📝 文档更新

- 更新 README.md，添加成语游戏功能说明和命令示例
- 更新 COMMANDS.md，添加完整的成语游戏命令参考
- 优化文档结构，使用折叠标签组织命令说明

### 🐛 修复问题

- 修复 `db.js` 中缺少 `getCategorySelection` 方法导致的模块加载错误
- 修复 `utils.js` 中依赖注入时的错误处理，添加方法存在性检查
- 重建缺失的数据模块：`pinyin.js`、`idiom.js`、`equation.js`
- 增强模块加载的健壮性，避免因方法缺失导致的插件启动失败

---

## [fork-1.0.0] - 2025-12-04

### 🎉 重大更新

这是 fork 版本的第一个正式版本，包含大量的架构优化和功能增强。

### ✨ 新增功能

#### 单词游戏功能
- 支持使用 `#word` 命令启动单词游戏（原 `#wordle`）
- 完整的词典管理系统，支持多词典切换
- 单词释义查询功能（`#释义` 命令）
- 群聊和私聊双场景支持

#### 数学公式游戏功能
- 支持使用 `#math`、`#Math`、`#数学`、`#公式` 命令启动数学公式游戏
- 支持 5-12 字符长度的普通公式游戏
- 支持 12、14、16 字符长度的特殊公式游戏（包含幂运算 `**`）
- 按长度、运算符、难度分类的公式库
- 数学游戏排行榜功能

#### 排行榜系统
- 群排行榜：按群组记录游戏数据
- 全局排行榜：跨群组统计游戏数据
- 支持胜场榜、参与榜、胜率榜三种榜单类型
- 单词游戏和数学游戏共享排行榜系统

### 🔧 架构优化

#### 代码结构重构
- **模块化拆分**：将单体 `Wordle.js` 拆分为 `Word.js` 和 `Math.js` 两个独立插件
- **工具文件夹优化**：
  - `utils/games/` - 游戏逻辑模块（`base.js`、`word.js`、`math.js`）
  - `utils/data/` - 数据管理模块（`word.js`、`equation.js`、`db.js`、`leaderboard.js`）
  - `utils/render/` - 渲染模块（`renderer.js`）
- **基类设计**：创建 `GameBase` 类，共享游戏通用逻辑
- **依赖注入**：优化模块间的依赖关系管理

#### 命令系统优化
- 单词游戏命令从 `#wordle` 改为 `#word`
- 数学游戏命令支持多种格式：`#math`、`#Math`、`#数学`、`#公式`
- 命令别名支持更灵活，支持中英文混合使用

#### 文件命名规范化
- `word-game.js` → `games/word.js`
- `math-game.js` → `games/math.js`
- `game-base.js` → `games/base.js`
- `word-new.js` → `data/word.js`
- 统一去除冗余的 `-game` 后缀

### 🐛 修复问题

- 修复特殊分类公式长度验证问题
- 修复游戏上下文获取逻辑，支持私聊场景
- 修复公式验证逻辑，特殊模式下仅在 `special` 文件夹中验证
- 修复重复显示公式的问题
- 修复变量声明冲突问题

### 📝 文档更新

- 更新 README.md，反映最新的命令和功能
- 创建 COMMANDS.md，提供完整的命令参考文档
- 优化代码注释和文档字符串

### 🗑️ 删除

- 移除废弃的 `game.js` 单体文件（984行）
- 移除冗余的文件和代码

### ⚙️ 技术改进

- 优化 Canvas 渲染性能
- 改进游戏状态管理
- 增强错误处理机制
- 优化文件路径处理逻辑

---

## 版本说明

- **fork-1.0.0**: Fork 版本的第一个正式发布版本
- 基于原项目进行大量架构优化和功能增强
- 保持向后兼容性的同时，提供更好的代码组织和维护性

---

*此 CHANGELOG 从 fork-1.0.0 版本开始维护。*

